generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model User {
  id           String   @id @default(uuid())
  email        String   @unique
  passwordHash String?  // Optional since we might do passwordless or just email
  createdAt    DateTime @default(now())
  
  profile      Profile?
  plans        Plan[]
}

model Profile {
  id                        String   @id @default(uuid())
  userId                    String   @unique
  user                      User     @relation(fields: [userId], references: [id])
  
  goal                      String
  equipment                 String   // JSON array stringified
  timePerWorkout            Int
  experienceLevel           String
  recentConsistency         String
  painAreas                 String   // JSON array stringified
  movementRestrictions      String   // JSON array stringified
  workoutStylePreference    String
  focusAreas                String   // JSON array stringified
  intensityPreference       String
  startingAbilityPushups    String?
  startingAbilitySquats     String?
  startingAbilityPlank      String?
  sleepBucket               String
  preferenceExclusions      String   // JSON array stringified
}

model Exercise {
  id                       String   @id @default(uuid())
  externalId               String?  // The EX001 ID from Excel
  name                     String
  description             String?
  videoUrl                 String?
  difficultyMin           String   // beginner, some, intermediate, advanced
  difficultyMax           String
  
  equipmentTags           String   // JSON array stringified
  workoutType             String   // strength, cardio, mobility, recovery
  movementPattern         String   // squat, hinge, lunge, push, pull, core, posture, conditioning, mobility
  focusAreaTags           String   // JSON array stringified
  impactLevel             String   // low, high
  avoidModifyFlags        String   // JSON array stringified (e.g., ["knees", "back"])
  preferenceExclusionFlags String   // JSON array stringified (e.g., ["running", "jumping"])
  phaseTags               String   // JSON array stringified (e.g., ["Stretching", "Main exercise", "Cool off"])
  
  easierVariationId       String?
  harderVariationId       String?
  notes                   String?
  
  workoutExercises        WorkoutExercise[]
}

model Plan {
  id                String   @id @default(uuid())
  userId            String
  user              User     @relation(fields: [userId], references: [id])
  createdAt         DateTime @default(now())
  startDate         DateTime @default(now())
  status            String   @default("active") // active, completed
  
  days              WorkoutDay[]
}

model WorkoutDay {
  id                String    @id @default(uuid())
  planId            String
  plan              Plan      @relation(fields: [planId], references: [id])
  
  dayNumber         Int       // 1-30
  weekNumber        Int       // 1-4
  dayType           String    // e.g., "Strength Lower Focus"
  isOptional        Boolean   @default(false)
  
  estimatedMinutes  Int
  isCompleted       Boolean   @default(false)
  completedAt       DateTime?
  
  exercises         WorkoutExercise[]
}

model WorkoutExercise {
  id                String   @id @default(uuid())
  workoutDayId      String
  workoutDay        WorkoutDay @relation(fields: [workoutDayId], references: [id])
  
  exerciseId        String
  exercise          Exercise   @relation(fields: [exerciseId], references: [id])
  
  role              String   // warm-up, main, accessory, conditioning, mobility, cool off
  targetSets        Int?
  targetReps        Int?
  targetSeconds     Int?
  targetRestSeconds Int?
  sortOrder         Int      // Position in the workout
  
  logs              ExerciseLog[]
}

model ExerciseLog {
  id                String @id @default(uuid())
  workoutExerciseId String
  workoutExercise   WorkoutExercise @relation(fields: [workoutExerciseId], references: [id])
  
  setNumber         Int
  reps              Int?
  seconds           Int?
  weight            Float?
  isDone            Boolean @default(false)
}
