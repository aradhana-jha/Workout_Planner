generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id           String   @id @default(uuid())
  email        String   @unique
  passwordHash String?
  createdAt    DateTime @default(now())
  
  profile      Profile?
  plans        Plan[]
}

model Profile {
  id                      String   @id @default(uuid())
  userId                  String   @unique
  user                    User     @relation(fields: [userId], references: [id])
  
  // Q1: Goal
  goal                    String
  
  // Q2: Equipment (JSON array)
  equipment               String
  
  // Q3: Time per workout
  timePerWorkout          Int
  
  // Q4: Experience level
  experienceLevel         String
  
  // Q5: Recent consistency
  recentConsistency       String
  
  // Q6: Pain areas (JSON array)
  painAreas               String
  
  // Q7: Movement restrictions (JSON array)
  movementRestrictions    String
  
  // Q8: Workout style preference
  workoutStylePreference  String
  
  // Q9: Focus areas (JSON array)
  focusAreas              String
  
  // Q10: Intensity preference
  intensityPreference     String
  
  // Q11: Starting abilities (optional)
  startingAbilityPushups  String?
  startingAbilitySquats   String?
  startingAbilityPlank    String?
  
  // Q12: Sleep
  sleepBucket             String
  
  // Q13: Preference exclusions (JSON array)
  preferenceExclusions    String
}

model Exercise {
  id                       String   @id @default(uuid())
  externalId               String?  @unique
  name                     String
  description              String?
  videoUrl                 String?
  
  difficultyMin            String
  difficultyMax            String
  equipmentTags            String
  workoutType              String
  movementPattern          String
  focusAreaTags            String
  impactLevel              String
  avoidModifyFlags         String
  preferenceExclusionFlags String
  phaseTags                String
  
  easierVariationId        String?
  harderVariationId        String?
  notes                    String?
  
  workoutExercises         WorkoutExercise[]
}

model Plan {
  id        String   @id @default(uuid())
  userId    String
  user      User     @relation(fields: [userId], references: [id])
  
  startDate DateTime @default(now())
  status    String   @default("active")
  
  days      WorkoutDay[]
}

model WorkoutDay {
  id               String    @id @default(uuid())
  planId           String
  plan             Plan      @relation(fields: [planId], references: [id])
  
  dayNumber        Int
  weekNumber       Int
  dayType          String
  
  isOptional       Boolean   @default(false)
  estimatedMinutes Int
  
  isCompleted      Boolean   @default(false)
  completedAt      DateTime?
  
  exercises        WorkoutExercise[]
}

model WorkoutExercise {
  id                String       @id @default(uuid())
  workoutDayId      String
  workoutDay        WorkoutDay   @relation(fields: [workoutDayId], references: [id])
  
  exerciseId        String
  exercise          Exercise     @relation(fields: [exerciseId], references: [id])
  
  role              String
  
  targetSets        Int?
  targetReps        Int?
  targetSeconds     Int?
  targetRestSeconds Int?
  
  sortOrder         Int
  notes             String?
  
  logs              ExerciseLog[]
}

model ExerciseLog {
  id                String @id @default(uuid())
  workoutExerciseId String
  workoutExercise   WorkoutExercise @relation(fields: [workoutExerciseId], references: [id])
  
  setNumber         Int
  reps              Int
  weight            Float?
  isDone            Boolean @default(false)
}
